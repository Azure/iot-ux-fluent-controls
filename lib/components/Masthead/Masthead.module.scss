@import '../../common/color.controls';
@import '../../common/constants';
@import '../../common/mixins';

$masthead-branding-width: 50%;
$masthead-brandname-width: 200px;
$masthead-application-breakpoint: 3 * $masthead-brandname-width - 1;
$masthead-collapse-start: 660px;
$thumbnail-size: $icon-size-base * 2;
$branding-min-width-size: 120px;

@mixin selected {
    &.selected {
        background-color: themed('color-bg-searchbar');

        >* {
            background-color: themed('color-bg-searchbar');
            color: themed('color-text-rest');
        }

        &:focus {
            outline: 1px dashed themed('color-text-black');

            >* {
                outline: none;
                color: themed('color-text-black');
            }
        }

        &:active>* {
            color: themed('color-text-black');
        }

        &:hover,
        &:hover>* {
            background-color: themed('color-bg-panel-contextual');

            >* {
                outline: none;
                background-color: themed('color-bg-panel-contextual');
                color: themed('color-text-rest');
            }

        }
    }
}

@mixin action-trigger-override {
    outline: none;
    color: themed('color-text-white');
}

.masthead {
    display: flex;
    height: $layout-nav-item-height;
    flex-grow: 0;
    flex-shrink: 0;
    justify-content: space-between;

    .nav-container {
        // show nav in masthead only in small screens:
        display: none;

        @media(max-width: $screen-sm) {
            width: $layout-nav-collapsed-width;
            display: initial;
        }

        .nav-icon-collapsed {
            transform: rotate(90deg);
        }

        .nav-icon-expanded {
            transform: rotate(-90deg);
        }

        .nav-panel {
            width: $layout-nav-expanded-width;
        }
    }

    .masthead-branding {
        width: $masthead-branding-width;
        height: $layout-nav-item-height;
        display: inline-block;
        padding: 0px $gutter-normal;
        line-height: $layout-nav-item-height;
        font-size: $font-size-h3;
        font-weight: bold;
        min-width: $branding-min-width-size;
    }

    .masthead-toolbar-container {
        width: 100% - $masthead-branding-width;
        text-align: right;
        position: relative;

        .masthead-toolbar {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            justify-content: flex-end;
            list-style-type: none;

            .masthead-toolbar-btn {
                width: $layout-nav-item-height;
                height: $layout-nav-item-height;
                line-height: $layout-nav-item-height;
                justify-content: center;
                align-items: center;
                border: none;
                white-space: nowrap;
                text-decoration: none;
                padding: 0;
                display: inline-flex;
                cursor: pointer;
                vertical-align: middle;
                align-content: center;

                &:focus,
                &:active {
                    outline-offset: -1px;
                }

                // align all the icons
                :before {
                    width: $icon-size-base;
                    height: $icon-size-base;
                    vertical-align: baseline;
                }

                &.user-btn {
                    >:global(.icon-alias-user) {
                        width: $thumbnail-size;
                        height: $thumbnail-size;
                        font-size: $font-size-h5;
                        border-radius: 50%;
                    }
                }

                &.hidden {
                    display: none;
                }

                &.sm {
                    display: none;

                    @media(max-width: $screen-sm) {
                        // $screen-sm: 480px;
                        display: inline-flex;
                    }
                }

                &.md {
                    display: inline-flex;

                    @media(max-width: $screen-md) {
                        // $screen-md: 768px;
                        display: none;
                    }
                }
            }
        }
    }

    // THEME
    @include themify {
        color: themed('color-text-white');
        background-color: themed('color-bg-masthead');

        .masthead-toolbar-container {
            .masthead-toolbar {

                .masthead-toolbar-btn,
                .masthead-toolbar-btn>* {
                    background-color: themed('color-bg-masthead');
                    color: themed('color-text-white');

                    &:focus {
                        outline: 1px dashed themed('color-text-white');
                        color: themed('color-text-white');

                        >* {
                            @include action-trigger-override();
                        }
                    }

                    &:active {
                        outline: 1px dashed themed('color-text-white');
                        background-color: themed('color-text-white');

                        >* {
                            background-color: themed('color-text-white');
                            @include action-trigger-override();
                        }

                        &:focus {
                            outline: 1px dashed themed('color-text-white');
                            color: themed('color-text-white');

                            >* {
                                @include action-trigger-override();
                            }
                        }
                    }

                    &:hover,
                    &:hover>* {
                        background-color: themed('color-bg-masthead-hover');
                    }

                    @include selected();

                    &.user-btn {
                        background-color: transparent;

                        >:global(.icon-alias-user) {
                            background-color: themed('color-border-masthead-item');
                        }

                        @include selected();
                    }
                }
            }
        }
    }

    // RTL
    @include rtl {
        .masthead-branding {
            direction: rtl;
            margin-left: unset;
            margin-right: 0;
        }

        .masthead-toolbar-container {
            direction: rtl;
            text-align: left;

            .masthead-toolbar-btn {
                @include themify {
                    border-right: 1px solid themed('color-border-panel');
                }

                border-left: 0;
            }
        }
    }
}

// MIXIN
@mixin collapse($count) {
    $breakpoint: $masthead-collapse-start - $count * $layout-nav-item-height;

    @media (min-width: $breakpoint + 1) {
        .collapse-#{$count}-inverse {
            display: none;
        }
    }

    @media (max-width: $breakpoint) {
        .collapse-#{$count} {
            display: none;
        }
    }
}

@for $i from 0 through 10 {
    @include collapse($i);
}

@media (max-width: $masthead-application-breakpoint) {
    .masthead-branding *+* {
        display: none;
    }
}